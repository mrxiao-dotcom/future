# 项目需求文档

## 2024-11-05 初始需求
### 功能需求
1. 期货基础数据获取
   - [ ] 期货行情数据获取功能
     * 支持选择日期
     * 显示期货代码、名称、收盘价、涨跌幅等信息
   - [ ] 期货持仓量数据获取功能
     * 支持选择日期
     * 显示多空持仓量、净持仓等信息
   - [ ] 机构净持仓数据获取功能
     * 支持选择日期
     * 显示机构持仓变化情况

2. 期货数据筛选
   - [ ] 涨跌幅范围筛选
     * 支持设置最小值和最大值
   - [ ] 成交额范围筛选
     * 支持设置最小值和最大值（单位：万元）
   - [ ] 机构持仓变化筛选
     * 支持筛选增加/减少/所有
   - [ ] 筛选结果展示
     * 表格形式展示符合条件的期货

3. 期货信息展示
   - [ ] 期货品种选择
     * 下拉框选择具体期货品种
   - [ ] 近7日数据展示
     * 每日涨跌幅图表
     * 每日成交额图表
     * 持仓量变化图表
     * 机构持仓变化图表

### 界面需求
1. 导航设计
   - [x] 左侧竖向标签栏
   - [x] 标签文字竖向排列
   - [x] 响应式布局

2. 数据展示
   - [ ] 表格展示
     * 支持排序
     * 支持分页
   - [ ] 图表展示
     * 使用ECharts绘制
     * 支持数据缩放
     * 支持图表联动

### 开发进度
1. 2024-11-05
   - [x] 创建项目基础结构
   - [x] 实现数据库连接
   - [x] 设计基础界面布局
   - [x] 实现导航标签竖向排列

2. 待完成工作
   - [ ] 实现数据获取API
   - [ ] 实现数据筛选功能
   - [ ] 实现图表展示
   - [ ] 完善错误处理
   - [ ] 添加数据导出功能 

## 2024-11-05 期货基础数据获取需求
### 功能需求
1. 主力合约数据获取
   - [ ] 自动获取最近30个交易日的数据
   - [ ] 获取三类数据：
     * 日线行情数据
     * 仓单数据
     * 机构持仓数据
   - [ ] 自动清理超过30天的历史数据
   - [ ] 支持中断数据获取过程

2. 数据更新进度展示
   - [x] 实时显示更新进度
   - [x] 显示详细的更新状态
   - [x] 提供更新日志
   - [x] 支持取消更新操作

3. 数据处理
   - [ ] 自动处理重复数据
   - [ ] 数据格式验证
   - [ ] 异常数据处理
   - [ ] 数据完整性检查

### 性能需求
1. 请求频率控制
   - [x] 限制Tushare API调用频率（每分钟200次）
   - [x] 实现请求队管理
   - [x] 自动处理限等待

2. 数据库操作
   - [x] 使用数据库连接池
   - [x] 批量数据处理
   - [x] 事务管理

### 异常处理
1. 网络异常
   - [ ] 自动重试机制
   - [ ] 断点续传
   - [ ] 超时处理

2. 数据异常
   - [ ] 数据格式错误处理
   - [ ] 空值处理
   - [ ] 异常数据记录

### 日志记录
1. 更新日志
   - [x] 记录每个交易所的更新状态
   - [x] 记录更新的品种数量
   - [x] 记录错误信息
   - [x] 实时显示处理进度 

## 2024-11-05 期货品种管理需求
### 功能需求
1. 期货品种展示
   - [x] 按交易所分组显示期货品种
   - [x] 显示品种中文名称
   - [x] 支持品种点击展开查看详情

2. 合约信息展示
   - [x] 显示合约基本信息
   - [x] 区分不同类型合约
   - [x] 显示合约交易状态
   - [x] 支持合约类型筛选

3. 数据更新功能
   - [x] 自动获取新品种
   - [x] 保留现有数据
   - [x] 支持取消更新
   - [x] 显示更新进度

### 数据需求
1. 合约数据
   - [x] 基础信息完整性
   - [x] 交易相关信息
   - [x] 日期信息规范
   - [x] 状态信息准确

2. 数据处理
   - [x] 自动处理重复数据
   - [x] 数据格式标准化
   - [x] 特殊字符处理
   - [x] 空值处理

### 展示需求
1. 种示
   - [x] 分组清晰
   - [x] 名称规范
   - [x] 布局合理
   - [x] 响应式设计

2. 合约展示
   - [x] 信息完整
   - [x] 状态明确
   - [x] 类型区分
   - [x] 日期格式统一 

## 2024-11-05 期货数据获取需求
### 功能需求
1. 数据获取范围
   - [x] 获取所有未到期合约的当日数据
   - [x] 主力合约获取30天数据
   - [x] 自动识别主力合约
   - [x] 自动清理过期数据

2. 数据检查和处理
   - [x] 检查数据是否已存在
   - [x] 避免重复调用API
   - [x] 处理空值和异常值
   - [x] 数据格式标准化

3. 数据存储
   - [x] 日线行情数据存储
   - [x] 持仓排名数据存储
   - [x] 增量更新机制
   - [x] 数据完整性验证

### 性能需求
1. API调用优化
   - [x] 避免重复请求
   - [x] 请求频率控制
   - [x] 错误重试机制
   - [x] 并发控制

2. 数据库操作
   - [x] 批量数据处理
   - [x] 事务管理
   - [x] 索引优化
   - [x] 连接池管理

### 用户体验
1. 进度展示
   - [x] 实时进度更新
   - [x] 详细处理日志
   - [x] 当前处理状态
   - [x] 错误信息展示

2. 操作控制
   - [x] 支持取消操作
   - [x] 状态实时反馈
   - [x] 异常处理机制
   - [x] 完成后自动清理

## 2024-11-06 机构持仓排名需求
### 功能需求
1. 数据展示
   - [x] 显示所有持仓记录
   - [x] 按持仓量排序
   - [x] 显示合约代码和日期
   - [x] 支持多空持仓切换

2. 数据处理
   - [x] 合并同名期货公司数据
   - [x] 处理代客户户数据
   - [x] 保留最大持仓记录
   - [x] 自动清理重复数据

3. 数据查询
   - [x] 支持模糊匹配
   - [x] 处理不同交易所代码
   - [x] 获取最新日期数据
   - [x] 优化查询性能

## 2024-11-07 机会筛选模块需求
### 功能需求
1. 合约选择
   - [x] 按交易所分类显示
   - [x] 支持合约双向移动
   - [x] 一键清空已选合约
   - [x] 保持选择状态

2. 组合管理
   - [x] 保存组合配置
   - [x] 手动输入合约代码
   - [x] 支持多种分隔符
   - [x] 组合的增删改查

3. 净值曲线
   - [x] 自动补充缺失数据
   - [x] 合并计算总净值
   - [x] 动态更新图表
   - [x] 自适应显示区域

### 用户体验
1. 界面布局
   - [x] 三栏布局设计
   - [x] 合理分配空间
   - [x] 自适应屏幕尺寸
   - [x] 美化滚动条样式

2. 交互优化
   - [x] 双击加载组合
   - [x] 拖拽调整大小
   - [x] 实时数据更新
   - [x] 友好的提示信息

## 2024-11-07 净值曲线功能需求
### 数据处理
1. 数据获取
   - [x] 获取最近一年的数据
   - [x] 只获取每天14:30的数据
   - [x] 处理未上市合约的初始资金
   - [x] 自动补充缺失数据

2. 数据计算
   - [x] 计算每个时间点的总净值
   - [x] 计算最高权益和时间
   - [x] 计算最大回撤和当前回撤
   - [x] 计算回撤持续天数

3. 数据展示
   - [x] 显示最高权益和时间
   - [x] 显示最低权益和当前权益
   - [x] 显示回撤天数和警示
   - [x] 优化Y轴显示范围

### 性能优化
1. 数据查询
   - [x] 优化SQL查询效率
   - [x] 减少数据库访问次数
   - [x] 使用缓存机制
   - [x] 限制数据范围

2. 前端展示
   - [x] 图表自适应大小
   - [x] 数据按需加载
   - [x] 优化更新机制
   - [x] 减少重复渲染

## 2024-11-07 实时展示功能需求
### 界面布局
1. 上部分组合选择（20%）
   - [x] 左侧组合列表
   - [x] 右侧品种详情
   - [x] 开始监测按钮
   - [x] 双击加载组合详情

2. 下部分动态表格（80%）
   - [x] 自动定时刷新（05,35分）
   - [x] 显示最近20个时间点
   - [x] 时间点作为列标题
   - [x] 关键指标数据展示

### 数据展示
1. 权益数据
   - [x] 当前权益
   - [x] 过去一年最高权益
   - [x] 最高权益发生时间
   - [x] 当前回撤比例

2. 回撤统计
   - [x] 回撤持续时间
   - [x] 过去一年最大回撤
   - [x] 回撤预警提示
   - [x] 实时更新状态

3. 持仓统计
   - [x] 品种总数统计
   - [x] 多空品种统计
   - [x] 净多空计算
   - [x] 持仓结构分析

### 数据更新
1. 定时刷新
   - [x] 每30分钟自动刷新
   - [x] 05,35分钟执行
   - [x] 交易时间段判断
   - [x] 错过刷新补偿

2. 数据计算
   - [x] 一年数据获取
   - [x] 最大权益计算
   - [x] 回撤指标计算
   - [x] 多空统计计算

## 2024-11-07 主力合约监控需求
### 功能需求
1. 主力合约列表展示
   - [x] 显示所有主力合约
   - [x] 按交易所分组显示
   - [x] 支持多列排序
   - [x] 支持交易所筛选

2. 合约数据展示
   - [x] 合约基本信息
   - [x] 成交量和持仓量
   - [x] 日/周/月成交额统计
   - [x] 振幅统计
   - [x] 价格区间统计
   - [x] 价格位置百分比

3. 合约详情查看
   - [x] 显示最近10天行情
   - [x] 涨跌幅变化趋势
   - [x] 成交额变化趋势
   - [x] 持仓量变化趋势
   - [x] 相关合约信息

### 数据需求
1. 行情数据
   - [x] 实时价格数据
   - [x] 历史行情数据
   - [x] 成交量数据
   - [x] 持仓量数据

2. 统计数据
   - [x] 日均成交额
   - [x] 周均成交额
   - [x] 月均成交额
   - [x] 价格区间统计
   - [x] 振幅统计

### 性能需求
1. 数据加载
   - [x] 异步加载数据
   - [x] 分页加载
   - [x] 缓存机制
   - [x] 按需更新

2. 界面响应
   - [x] 快速排序
   - [x] 实时筛选
   - [x] 平滑切换
   - [x] 动态更新

## 2024-11-08 实时监控净值图表需求
### 功能需求
1. 图表展示
   - [ ] 复用机会筛选模块的净值计算逻辑
   - [ ] 实时更新净值数据
   - [ ] 显示关键指标数据
   - [ ] 支持图表交互操作

2. 数据更新
   - [ ] 与监控数据同步更新
   - [ ] 保持图表状态
   - [ ] 自动调整显示范围
   - [ ] 优化更新性能

3. 交互功能
   - [ ] 支持缩放查看
   - [ ] 支持拖拽平移
   - [ ] 显示数据提示
   - [ ] 自适应容器大小

### 性能需求
1. 数据处理
   - [ ] 复用现有计算逻辑
   - [ ] 优化数据结构
   - [ ] 减少重复计算
   - [ ] 合理使用缓存

2. 渲染优化
   - [ ] 控制更新频率
   - [ ] 按需重绘图表
   - [ ] 优化动画效果
   - [ ] 处理大量数据